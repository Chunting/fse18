** Paper ** : [Data Race Detection on Compressed Traces](paper.pdf), FSE 2018, to appear  
** Authors ** : Dileep Kini, Umang Mathur, Mahesh Viswanathan  
** Applying for ** : Reusable and Available badges.  
___

# Artifact for "Data Race Detection on Compressed Traces"

The artifact implements algorithms for analyzing traces of
multi-threaded programs, compressed as straight line programs,
for HB races and violations of lockset principle.

Please contact the following author for questions:
```
Umang Mathur
Department of Computer Science
University of Illinois, Urbana Champaign, USA
umathur3@illinois.edu
```

The detailed `README.md` files for the individual components
can be found in the individual folders.

The file `INSTALL.md` details how to install the relevant packages to run the tool.

After having installed the required software artifacts, please
follow these steps:

## 1. Obtaining trace logs

Trace logs can be obtained from [here](https://uofi.box.com/v/fse-ziptrack).
Download and extract the folder `fse_ziptrack` and rename it to `logs`.
Move the `logs` directory to the root directory (which contains this `README.md` file):
```
> unzip fse_ziptrack.zip
> mv fse_ziptrack `pwd`/logs
```
This directory contains a `bin` folder. 
For every `<benchmark>`, there is a directory `logs/bin/<benchmark>`.
This directory contains several files with a `.bin` extension. 
These `.bin` files are created by [RVPredict's](https://runtimeverification.com/predict/) logger, which we use to log program executions.
Besides, this directory also contains files 
`trace.txt`, `map.txt` and `grammar.txt`.
The file `trace.txt` is a sequence of integers, each of which corresponds to an event.
The mapping from these integers to events can be found in `map.txt`.
The file `grammar.txt` is the compressed SLP generated by Sequitur for the
sequence in `trace.txt`.

## 1'. (OPTIONAL) Generating traces and SLPs

** This step is completely optional for users intending only to reproduce results from the paper. This step might take up significant time and memory. ** 

### Generating traces for benchmarks from the paper

(a) Generate RVPredict traces for a particular benchmark `<benchmark>`:
```
> cd scripts/
> python generateRVPredictTraces.py <benchmark>
> cd ..
```
For example, to generate trace for `account`, execute:
```
> cd scripts/
> python generateRVPredictTraces.py account
> cd ..
```
This creates `.bin` files (and other non-relevant files) inside `logs/bin/account`.

To perform this step for all benchmarks at once, execute:
```
> cd scripts/
> python generateRVPredictTraces.py
> cd ..
```

(b) Now convert RVPredict trace files into a readable format.
```
> cd scripts/
> python convertTracesToReadableFormat.py
> cd ..
```
For a particular <benchmark>, execute:
```
> cd scripts/
> python convertTracesToReadableFormat.py <benchmark>
> cd ..
```
(c) Finally compress the traces generated:
```
> cd scripts/
> python compressTraces.py [<benchmark>]
> python transformGrammar.py [<benchmark>]
> cd ..
```

** Remark ** : For the remaining instructions we assume that the machine being used allows 30GB RAM.
If this is not the case, please change the Java flags `-Xmx30000m` and `-Xms30000m` accordingly.

### Generating trace for your own benchmark

(a) First extract a trace using RVPredict
```
> ${rvpredict}/bin/rv-predict --log --base-log-dir logs/bin --log-dirname <test_name> -cp /path/to/jar main.Class
```
where

- `${rvpredict}` must have been set (see `INSTALL.md`)
- `<test_name>` specifies the name of the test. You can choose your favorite name.
- `main.Class` specifies the path to the class that implements the main function
- `-cp /path/to/jar` is an optional parameter to specify the classpath to locate the class `main.Class`

This command creates a directory `logs/bin/<test_name>` and several `.bin` files inside this directory.

(b) Now execute the following commands to get a compressed SLP:
```
## Convert RVPredict trace to a readable format.
> java -Xmx30000m -Xms30000m -classpath ${ziptrack}/bin:${ziptrack}/lib/* PrintTrace -p=logs/bin/<test_name>/

## Compress the trace into an SLP.
> ${sequitur}/sequitur -d -p -m 10000 < logs/bin/<trace_name>/trace.txt > logs/bin/<test_name>/grammar.txt

## Transform the grammar to enable certain optimizations.
> mv logs/bin/<test_name>/grammar.txt logs/bin/<test_name>/original_grammar.txt
> java -Xmx30000m -Xms30000m -classpath ${ziptrack}/bin:${ziptrack}/lib/* TransformGrammar -m logs/bin/<test_name>/map.txt -t logs/bin/<test_name>/original_grammar.txt > logs/bin/<test_name>/grammar.txt
```
where both `${ziptrack}` and `${sequitur}` must have been set (see `INSTALL.md`).

The above commands generate files `trace.txt`, `map.txt` and `grammar.txt`, whose descriptions have been provided above in Step 1.

## 2. Running ZipTrack analyses

### 2.a HB race detection

To run HB analysis on compressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python zipHB.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the compressed trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${ziptrack}/bin:${ziptrack}/lib/* ZipHB -m logs/bin/<test_name>/map.txt -t logs/bin/<test_name>/grammar.txt
```

This step creates directory `logs/ZipHB/<benchmark>` or `logs/ZipHB/<test_name>`.
This directory contains files `ZipHB.txt`, describing the output from the analysis and `ZipHB.err`, describing the error produced if any.
The file `ZipHB.txt` lists the time for analysis in the first line.

### 2.b Lockset violation detection

To run lockset analysis on compressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python zipLockSet.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the compressed trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${ziptrack}/bin:${ziptrack}/lib/* ZipLockSet -m logs/bin/<test_name>/map.txt -t logs/bin/<test_name>/grammar.txt 
```
This step creates directory `logs/ZipLockSet/<benchmark>` or `logs/ZipLockSet/<test_name>`.
This directory contains files `ZipLockSet.txt`, describing the output from the analysis and `ZipLockSet.err`, describing the error produced if any.
The file `ZipLockSet.txt` lists the time for analysis in the first line.

### 2.c Getting statistics about the compressed trace

To get statistics on compressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python zipMetaInfo.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the compressed trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${ziptrack}/bin:${ziptrack}/lib/* ZipMetaInfo -m logs/bin/<test_name>/map.txt -t logs/bin/<test_name>/grammar.txt
```

This step creates directory `logs/ZipMetaInfo/<benchmark>` or `logs/ZipMetaInfo/<test_name>`.
This directory contains files `ZipMetaInfo.txt`, describing the output from the analysis and `ZipMetaInfo.err`, describing the error produced if any.

## 3. Running analyses on uncompressed traces

### 3.a HB race detection via DJIT+ algorithm

To run HB analysis (DJIT+) on uncompressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python HB.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated RVPredict trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${rapid}/bin:${rapid}/lib/* HB -f=rv -p=logs/bin/<test_name>/ -s
```
This step creates directory `logs/HB/<benchmark>` or `logs/HB/<test_name>`.
This directory contains files `HB.txt`, describing the output from the analysis and `HB.err`, describing the error produced if any.

### 3.b HB race detection via FastTrack algorithm

To run HB analysis (FastTrack) on uncompressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python HBEpoch.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the RVPredict trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${rapid}/bin:${rapid}/lib/* HBEpoch -f=rv -p=logs/bin/<test_name>/ -s
```

This step creates directory `logs/HBEpoch/<benchmark>` or `logs/HBEpoch/<test_name>`.
This directory contains files `HBEpoch.txt`, describing the output from the analysis and `HBEpoch.err`, describing the error produced if any.

### 3.c HB race detection via GoldiLocks algorithm

To run HB analysis (FastTrack) on uncompressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python Goldilocks.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the RVPredict trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${rapid}/bin:${rapid}/lib/* Goldilocks -f=rv -p=logs/bin/<test_name>/ -s
```

This step creates directory `logs/Goldilocks/<benchmark>` or `logs/Goldilocks/<test_name>`.
This directory contains files `Goldilocks.txt`, describing the output from the analysis and `Goldilocks.err`, describing the error produced if any.

### 3.d Lockset violation detection

To run lockset analysis on uncompressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python LockSet.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the RVPredict trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${rapid}/bin:${rapid}/lib/* LockSet -f=rv -p=logs/bin/<test_name>/ -s
```

This step creates directory `logs/LockSet/<benchmark>` or `logs/LockSet/<test_name>`.
This directory contains files `LockSet.txt`, describing the output from the analysis and `LockSet.err`, describing the error produced if any.


### 3.e Statistics for uncompressed trace

To get statistics for the uncompressed traces for the benchmarks in the paper, execute:
```
> cd scripts/
> python MetaInfo.py [<benchmark>]
> cd ..
```
For a custom benchmark (assuming you have generated the RVPredict trace from Step-1 (optional)), execute:
```
java -Xmx30000m -Xms30000m -classpath ${rapid}/bin:${rapid}/lib/* MetaInfo -f=rv -p=logs/bin/<test_name>/ -s
```

This step creates directory `logs/MetaInfo/<benchmark>` or `logs/MetaInfo/<test_name>`.
This directory contains files `MetaInfo.txt`, describing the output from the analysis and `MetaInfo.err`, describing the error produced if any.

___

Please contact the following author for questions:
```
Umang Mathur
Department of Computer Science
University of Illinois, Urbana Champaign, USA
umathur3@illinois.edu
```
___